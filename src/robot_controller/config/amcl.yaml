# AMCL Configuration for Real Robot Navigation
# Tuned for differential drive robot with LiDAR sensor
# Cross-checked with gmapping parameters from robot_mapping.launch
# Updated: 2025-11-23

# ==============================================================================
# ODOMETRY MODEL (differential drive)
# TIN VÀO UKF ODOM RẤT NHIỀU - Chỉ để AMCL chỉnh drift nhẹ
# ==============================================================================
odom_model_type: diff
odom_alpha1: 0.01  # Rotation noise from rotation - RẤT TIN UKF!
odom_alpha2: 0.01  # Rotation noise from translation
odom_alpha3: 0.01  # Translation noise from translation
odom_alpha4: 0.01  # Translation noise from rotation
odom_alpha5: 0.01  # Translation noise (diff-corrected model)

# ==============================================================================
# LASER MODEL
# GIẢM TIN VÀO LASER - Chỉ dùng để correct drift nhẹ, không để jump
# ==============================================================================
laser_model_type: likelihood_field
laser_max_beams: 30           # GIẢM từ 60 - ít correction hơn
laser_z_hit: 0.7              # GIẢM từ 0.95 - tin laser ít hơn
laser_z_rand: 0.3             # TĂNG từ 0.05 - cho phép noise nhiều hơn
laser_sigma_hit: 0.2          # TĂNG từ 0.075 - mờ hơn, ít nhạy cảm
laser_likelihood_max_dist: 5.0

# ==============================================================================
# PARTICLE FILTER
# GIẢM particles để correction nhẹ hơn
# ==============================================================================
min_particles: 30             # GIẢM từ 50 - ít correction
max_particles: 100            # GIẢM từ 200 - tránh jump mạnh
kld_err: 0.1                  # TĂNG từ 0.05 - ít particles hơn
kld_z: 0.95                   # GIẢM từ 0.99 - ít confidence hơn

# ==============================================================================
# UPDATE THRESHOLDS
# Để visualize tốt cần update thường xuyên hơn
# ==============================================================================
update_min_d: 0.05            # Update mỗi 5cm (đủ để visualize mượt)
update_min_a: 0.1             # Update mỗi ~6 degrees
resample_interval: 2          # Resample thường xuyên hơn

# ==============================================================================
# TRANSFORM
# ==============================================================================
transform_tolerance: 1.0      # Độ trễ TF cho phép (seconds) - tăng lên vì UKF 30Hz

# ==============================================================================
# INITIAL POSE (khi set trong RViz)
# ==============================================================================
initial_pose_x: 0.0
initial_pose_y: 0.0
initial_pose_a: 0.0
initial_cov_xx: 0.25          # Variance X (0.5m std dev)
initial_cov_yy: 0.25          # Variance Y (0.5m std dev)
initial_cov_aa: 0.068         # Variance yaw (~15 degrees)

# ==============================================================================
# RECOVERY (tắt để tránh random particles khi mất localization)
# ==============================================================================
recovery_alpha_slow: 0.0
recovery_alpha_fast: 0.0

# ==============================================================================
# TUNING NOTES
# ==============================================================================
# - Localization không ổn định → tăng min/max_particles
# - CPU cao → giảm laser_max_beams, max_particles
# - Localization chậm → giảm update_min_d, update_min_a
# - Không tin odom → tăng odom_alpha values
# - Map mismatch → kiểm tra laser_sigma_hit
